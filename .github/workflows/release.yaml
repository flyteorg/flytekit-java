name: flytekit-java release

on:
  release:
    types: [created]

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
      with:
        fetch-depth: "0"
    - name: Cache local Maven repository
      uses: actions/cache@v2
      with:
        path: ~/.m2/repository
        key: ${{ runner.os }}-maven-prepare-release-${{ hashFiles('pom.xml') }}
    - name: Set up JDK 11
      uses: actions/setup-java@v1
      with:
        java-version: 11.0
    - uses: s4u/maven-settings-action@v2.2.0
      with:
        servers: |
            [{
              "id": "flytekit-java-release",
              "username": "${{ secrets.SONATYPE_USERNAME }}",
              "password": "${{ secrets.SONATYPE_PASSWORD }}"
            }]
    - name: Build with Maven
      env:
        RELEASE_REPOSITORY_URL: ${{ secrets.RELEASE_REPOSITORY_URL }}
        SNAPSHOTS_REPOSITORY_URL: ${{ secrets.SNAPSHOTS_REPOSITORY_URL }}
      run: mvn deploy release:prepare -DpreparationGoals=clean -DskipTests=true -Dghcr.io/${{ github.repository_owner }}/jflyte





       
